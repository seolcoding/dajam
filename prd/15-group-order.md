# ë‹¨ì²´ ì£¼ë¬¸ í†µí•© (Group Order Collector)

## 1. ê°œìš”

### 1.1 ë¬¸ì œ ì •ì˜
- íšŒì‹, ë‹¨ì²´ ì£¼ë¬¸ ì‹œ "ë­ ë¨¹ì„ë˜?" ì§ˆë¬¸ ë°˜ë³µ
- í•¸ë“œí°ì„ ëŒë ¤ê°€ë©° ë©”ë‰´ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ë©”ì‹ ì €ë¡œ ë©”ë‰´ ì·¨í•©í•˜ëŠ” ë²ˆê±°ë¡œì›€
- ì£¼ë¬¸ìê°€ ê°ìì˜ ì£¼ë¬¸ì„ ì¼ì¼ì´ ë©”ëª¨í•˜ê³  ì •ë¦¬í•´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨
- ì‹¤ì‹œê°„ ì£¼ë¬¸ í˜„í™© íŒŒì•… ì–´ë ¤ì›€
- ì •ì‚° ì‹œ ê³„ì‚°ì˜ ë³µì¡í•¨

### 1.2 ì†”ë£¨ì…˜
- í•œ ê°€ê²Œì—ì„œ ì—¬ëŸ¬ ì‚¬ëŒì˜ ì£¼ë¬¸ì„ ëª¨ì•„ì„œ ì •ë¦¬í•˜ëŠ” ì›¹ ì•±
- QR ì½”ë“œ ë˜ëŠ” ë§í¬ë¡œ ê°„í¸í•˜ê²Œ ì°¸ì—¬
- ê°ì ìì‹ ì˜ ë””ë°”ì´ìŠ¤ì—ì„œ ë©”ë‰´ ì„ íƒ
- ì‹¤ì‹œê°„ ì£¼ë¬¸ í˜„í™© í™•ì¸
- ìë™ ì§‘ê³„ ë° ì •ì‚°

### 1.3 íƒ€ê²Ÿ ì‚¬ìš©ì
- íšŒì‹ì„ ì£¼ê´€í•˜ëŠ” ì§ì¥ì¸
- ë‹¨ì²´ ë°°ë‹¬ ì£¼ë¬¸ì„ í•˜ëŠ” ë™ì•„ë¦¬/íŒ€
- ìŠ¤í„°ë”” ê·¸ë£¹, ì¹œêµ¬ ëª¨ì„ ë“±

## 2. ìœ ì‚¬ ì„œë¹„ìŠ¤ ë¶„ì„

### 2.1 ë°°ë‹¬ì˜ë¯¼ì¡± í•¨ê»˜ì£¼ë¬¸ ê¸°ëŠ¥
**ì¶œì²˜**: [ìš°ì•„í•œí˜•ì œë“¤ ê¸°ìˆ ë¸”ë¡œê·¸](https://techblog.woowahan.com/10232/)

#### ê¸°ëŠ¥ ë¶„ì„
- **ë„ì… ì‹œê¸°**: 2022ë…„ 10ì›” (ì¿ íŒ¡ì´ì¸ ëŠ” 2022ë…„ 8ì›” ì„ ë„ì…)
- **ì‘ë™ ë°©ì‹**:
  1. ê°€ê²Œ ìƒì„¸ í™”ë©´ì—ì„œ "í•¨ê»˜ì£¼ë¬¸" ë²„íŠ¼ í´ë¦­
  2. ì¹´ì¹´ì˜¤í†¡ ë“±ìœ¼ë¡œ ë§í¬ ê³µìœ 
  3. ì´ˆëŒ€ëœ ì¹œêµ¬ë“¤ì´ ê°ì ë©”ë‰´ ì„ íƒ
  4. ê²°ì œ ë‹´ë‹¹ìê°€ ìµœì¢… ì£¼ë¬¸ ë° ê²°ì œ

#### ì¥ì 
- ë°°ë¯¼ ì•± ë‚´ì—ì„œ ëª¨ë“  ê³¼ì • ì™„ê²°
- ì‹¤ì œ ì£¼ë¬¸ê¹Œì§€ ì—°ë™

#### í•œê³„
- ë°°ë¯¼ ê°€ë§¹ì ì—ë§Œ í•œì •
- ì•± ì„¤ì¹˜ í•„ìˆ˜
- í˜„ê¸ˆ/ì§ì ‘ ì£¼ë¬¸ ì‹œ ì‚¬ìš© ë¶ˆê°€

### 2.2 ìš°ë¦¬ ì•±ì˜ ì°¨ë³„í™” í¬ì¸íŠ¸
- ì–´ë–¤ ê°€ê²Œ/ì‹ë‹¹ì´ë“  ì‚¬ìš© ê°€ëŠ¥ (ë¹„ê°€ë§¹ì , ì˜¤í”„ë¼ì¸ ì‹ë‹¹ í¬í•¨)
- ì•± ì„¤ì¹˜ ë¶ˆí•„ìš” (ì›¹ ê¸°ë°˜)
- ë©”ë‰´ë¥¼ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ììœ  ì…ë ¥ ëª¨ë“œ ì§€ì›
- ì£¼ë¬¸ì„œ í˜•íƒœë¡œ ì¶œë ¥í•˜ì—¬ ì „í™”/ë°©ë¬¸ ì£¼ë¬¸ ê°€ëŠ¥
- ì •ì‚° ê¸°ëŠ¥ í¬í•¨

## 3. ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬

### 3.1 QR ì½”ë“œ ìƒì„±
```bash
npm install qrcode
npm install @types/qrcode --save-dev
```

**ê³µì‹ ë¬¸ì„œ**: [node-qrcode](https://github.com/soldair/node-qrcode)

**ê¸°ëŠ¥**:
- Canvas ë˜ëŠ” SVGë¡œ QR ì½”ë“œ ìƒì„±
- URLì„ QR ì½”ë“œë¡œ ì¸ì½”ë”©
- ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜µì…˜ (ìƒ‰ìƒ, í¬ê¸° ë“±)

### 3.2 BroadcastChannel API
**ì°¸ê³  ìë£Œ**:
- [DigitalOcean Tutorial](https://www.digitalocean.com/community/tutorials/js-broadcastchannel-api)
- [Telerik Guide](https://www.telerik.com/blogs/ultimate-guide-broadcast-channel-api)
- [TabStateSync Library](https://github.com/robertluiz/TabStateSync)

**ê¸°ëŠ¥**:
- ê°™ì€ originì˜ ì—¬ëŸ¬ íƒ­/ìœˆë„ìš° ê°„ ì‹¤ì‹œê°„ í†µì‹ 
- localStorage ì´ë²¤íŠ¸ë³´ë‹¤ ì•ˆì •ì 
- ë©”ì‹œì§€ ì „ì†¡/ìˆ˜ì‹  ê°„ë‹¨

**ë¸Œë¼ìš°ì € ì§€ì›**:
- Chrome, Firefox, Edge ì§€ì›
- Safari ì¼ë¶€ ë²„ì „ ë¯¸ì§€ì› â†’ localStorage fallback í•„ìš”

### 3.3 localStorage
- ì£¼ë¬¸ ë°ì´í„° ì˜êµ¬ ì €ì¥
- í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ë°ì´í„° ìœ ì§€
- BroadcastChannel ë¯¸ì§€ì› ë¸Œë¼ìš°ì €ì˜ í´ë°±

### 3.4 html2canvas (ì£¼ë¬¸ì„œ ì´ë¯¸ì§€ ë³€í™˜)
```bash
npm install html2canvas
npm install @types/html2canvas --save-dev
```

**ê¸°ëŠ¥**:
- HTML ìš”ì†Œë¥¼ Canvasë¡œ ë³€í™˜
- PNG ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
- ì¹´ì¹´ì˜¤í†¡ ê³µìœ ìš© ì´ë¯¸ì§€ ìƒì„±

## 4. ê¸°ìˆ  ìŠ¤íƒ

### 4.1 í”„ë¡ íŠ¸ì—”ë“œ
- **í”„ë ˆì„ì›Œí¬**: Vite + React 19 + TypeScript
- **ìŠ¤íƒ€ì¼ë§**: Tailwind CSS v4
- **ìƒíƒœê´€ë¦¬**: React useState/useContext
- **ë¼ìš°íŒ…**: React Router v6

### 4.2 ë°ì´í„° ì €ì¥
- **ë¡œì»¬ ì €ì¥ì†Œ**: localStorage
- **íƒ­ ê°„ ë™ê¸°í™”**: BroadcastChannel API
- **í´ë°±**: localStorage 'storage' ì´ë²¤íŠ¸

### 4.3 ë¼ì´ë¸ŒëŸ¬ë¦¬
- `qrcode`: QR ì½”ë“œ ìƒì„±
- `html2canvas`: ì£¼ë¬¸ì„œ ì´ë¯¸ì§€ ë³€í™˜
- `nanoid`: ê³ ìœ  ID ìƒì„±

## 5. í•µì‹¬ ê¸°ëŠ¥ ë° êµ¬í˜„

### 5.1 ì£¼ë¬¸ ì„¸ì…˜ ìƒì„± (í˜¸ìŠ¤íŠ¸)

#### UI í”Œë¡œìš°
1. ê°€ê²Œ/ì‹ë‹¹ ì´ë¦„ ì…ë ¥
2. ë©”ë‰´ ì…ë ¥ ë°©ì‹ ì„ íƒ:
   - **ê³ ì • ë©”ë‰´ ëª¨ë“œ**: ë¯¸ë¦¬ ë©”ë‰´ì™€ ê°€ê²© ì…ë ¥
   - **ììœ  ì…ë ¥ ëª¨ë“œ**: ì°¸ê°€ìê°€ ì§ì ‘ ë©”ë‰´ëª… ì…ë ¥
3. ì„¸ì…˜ ìƒì„± í›„:
   - ê³ ìœ  ì„¸ì…˜ ID ìƒì„± (nanoid)
   - QR ì½”ë“œ ìƒì„± (ì°¸ì—¬ ë§í¬ ì¸ì½”ë”©)
   - ë§í¬ ë³µì‚¬ ë²„íŠ¼
   - ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë²„íŠ¼
4. ë§ˆê° ì‹œê°„ ì„¤ì • (ì„ íƒ)

#### êµ¬í˜„ ìƒì„¸
```typescript
interface OrderSession {
  id: string;
  restaurantName: string;
  mode: 'fixed' | 'free';
  menus: MenuItem[];
  deadline?: Date;
  createdAt: Date;
  hostName: string;
}

interface MenuItem {
  id: string;
  name: string;
  price: number;
  description?: string;
}

function createSession(data: {
  restaurantName: string;
  mode: 'fixed' | 'free';
  menus: MenuItem[];
  deadline?: Date;
  hostName: string;
}): OrderSession {
  const sessionId = nanoid(10);
  const session: OrderSession = {
    id: sessionId,
    ...data,
    createdAt: new Date(),
  };

  // localStorageì— ì €ì¥
  localStorage.setItem(`session:${sessionId}`, JSON.stringify(session));

  return session;
}
```

### 5.2 ì£¼ë¬¸ ì°¸ì—¬ (ì°¸ê°€ì)

#### UI í”Œë¡œìš°
1. QR ìŠ¤ìº” ë˜ëŠ” ë§í¬ í´ë¦­ â†’ ì„¸ì…˜ í˜ì´ì§€ ì§„ì…
2. ë‹‰ë„¤ì„ ì…ë ¥ (ì¤‘ë³µ ì²´í¬)
3. ë©”ë‰´ ì„ íƒ:
   - **ê³ ì • ë©”ë‰´ ëª¨ë“œ**: ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì„ íƒ + ìˆ˜ëŸ‰ ì¡°ì ˆ
   - **ììœ  ì…ë ¥ ëª¨ë“œ**: ë©”ë‰´ëª…, ê°€ê²© ì§ì ‘ ì…ë ¥
4. íŠ¹ì´ì‚¬í•­/ìš”ì²­ì‚¬í•­ ë©”ëª¨ (ì„ íƒ)
5. ì œì¶œ ë²„íŠ¼ í´ë¦­

#### êµ¬í˜„ ìƒì„¸
```typescript
interface Order {
  id: string;
  sessionId: string;
  participantName: string;
  items: OrderItem[];
  specialRequest?: string;
  submittedAt: Date;
}

interface OrderItem {
  id: string;
  menuId?: string; // ê³ ì • ë©”ë‰´ ëª¨ë“œì—ì„œë§Œ
  menuName: string;
  price: number;
  quantity: number;
}

function submitOrder(sessionId: string, order: Omit<Order, 'id' | 'submittedAt'>): void {
  const orderId = nanoid(10);
  const fullOrder: Order = {
    ...order,
    id: orderId,
    submittedAt: new Date(),
  };

  // localStorageì— ì €ì¥
  const ordersKey = `orders:${sessionId}`;
  const existingOrders = JSON.parse(localStorage.getItem(ordersKey) || '[]');
  existingOrders.push(fullOrder);
  localStorage.setItem(ordersKey, JSON.stringify(existingOrders));

  // BroadcastChannelë¡œ ì‹¤ì‹œê°„ ì•Œë¦¼
  const channel = new BroadcastChannel(`session:${sessionId}`);
  channel.postMessage({
    type: 'NEW_ORDER',
    order: fullOrder,
  });
}
```

### 5.3 ì£¼ë¬¸ í˜„í™© (í˜¸ìŠ¤íŠ¸ ëŒ€ì‹œë³´ë“œ)

#### UI êµ¬ì„±
- **ì°¸ì—¬ì ëª©ë¡**: ì•„ë°”íƒ€ + ë‹‰ë„¤ì„ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)
- **ë©”ë‰´ë³„ ì§‘ê³„**: ë©”ë‰´ëª…, ìˆ˜ëŸ‰, ì†Œê³„
- **ì´ ê¸ˆì•¡**: ëª¨ë“  ì£¼ë¬¸ì˜ í•©ê³„
- **1ì¸ë‹¹ ê¸ˆì•¡**: ì´ ê¸ˆì•¡ Ã· ì°¸ì—¬ì ìˆ˜
- **ë¯¸ì£¼ë¬¸ì í‘œì‹œ**: ì•„ì§ ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì°¸ê°€ì í•˜ì´ë¼ì´íŠ¸

#### ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
```typescript
function useLiveOrders(sessionId: string) {
  const [orders, setOrders] = useState<Order[]>([]);

  useEffect(() => {
    // ì´ˆê¸° ë¡œë“œ
    const ordersKey = `orders:${sessionId}`;
    const initialOrders = JSON.parse(localStorage.getItem(ordersKey) || '[]');
    setOrders(initialOrders);

    // BroadcastChannel ë¦¬ìŠ¤ë„ˆ
    const channel = new BroadcastChannel(`session:${sessionId}`);
    channel.onmessage = (event) => {
      if (event.data.type === 'NEW_ORDER') {
        setOrders(prev => [...prev, event.data.order]);
      } else if (event.data.type === 'UPDATE_ORDER') {
        setOrders(prev => prev.map(o =>
          o.id === event.data.order.id ? event.data.order : o
        ));
      } else if (event.data.type === 'DELETE_ORDER') {
        setOrders(prev => prev.filter(o => o.id !== event.data.orderId));
      }
    };

    // localStorage fallback (Safari ë“±)
    const handleStorageChange = (e: StorageEvent) => {
      if (e.key === ordersKey && e.newValue) {
        setOrders(JSON.parse(e.newValue));
      }
    };
    window.addEventListener('storage', handleStorageChange);

    return () => {
      channel.close();
      window.removeEventListener('storage', handleStorageChange);
    };
  }, [sessionId]);

  return orders;
}
```

### 5.4 ì£¼ë¬¸ ë§ˆê° ë° ì •ë¦¬

#### ì£¼ë¬¸ì„œ ìƒì„±
```typescript
interface OrderSummary {
  restaurantName: string;
  totalAmount: number;
  perPersonAmount: number;
  participantCount: number;
  menuSummary: MenuSummaryItem[];
  orders: Order[];
}

interface MenuSummaryItem {
  menuName: string;
  totalQuantity: number;
  unitPrice: number;
  subtotal: number;
}

function generateOrderSummary(sessionId: string): OrderSummary {
  const session: OrderSession = JSON.parse(
    localStorage.getItem(`session:${sessionId}`) || '{}'
  );
  const orders: Order[] = JSON.parse(
    localStorage.getItem(`orders:${sessionId}`) || '[]'
  );

  // ë©”ë‰´ë³„ ì§‘ê³„
  const menuMap = new Map<string, MenuSummaryItem>();

  orders.forEach(order => {
    order.items.forEach(item => {
      const key = item.menuName;
      if (menuMap.has(key)) {
        const existing = menuMap.get(key)!;
        existing.totalQuantity += item.quantity;
        existing.subtotal += item.price * item.quantity;
      } else {
        menuMap.set(key, {
          menuName: item.menuName,
          totalQuantity: item.quantity,
          unitPrice: item.price,
          subtotal: item.price * item.quantity,
        });
      }
    });
  });

  const menuSummary = Array.from(menuMap.values());
  const totalAmount = menuSummary.reduce((sum, item) => sum + item.subtotal, 0);
  const participantCount = new Set(orders.map(o => o.participantName)).size;

  return {
    restaurantName: session.restaurantName,
    totalAmount,
    perPersonAmount: Math.ceil(totalAmount / participantCount),
    participantCount,
    menuSummary,
    orders,
  };
}
```

#### ì¹´ì¹´ì˜¤í†¡ ê³µìœ ìš© í…ìŠ¤íŠ¸
```typescript
function generateShareText(summary: OrderSummary): string {
  let text = `ğŸ“‹ ${summary.restaurantName} ë‹¨ì²´ ì£¼ë¬¸\n\n`;

  text += `ğŸ‘¥ ì°¸ì—¬ ì¸ì›: ${summary.participantCount}ëª…\n\n`;

  text += `ğŸ“ ì£¼ë¬¸ ë‚´ì—­:\n`;
  summary.menuSummary.forEach(item => {
    text += `  â€¢ ${item.menuName} x ${item.totalQuantity}ê°œ = ${item.subtotal.toLocaleString()}ì›\n`;
  });

  text += `\nğŸ’° ì´ ê¸ˆì•¡: ${summary.totalAmount.toLocaleString()}ì›\n`;
  text += `ğŸ’µ 1ì¸ë‹¹: ${summary.perPersonAmount.toLocaleString()}ì›\n\n`;

  text += `ğŸ“‹ ê°œì¸ë³„ ì£¼ë¬¸:\n`;
  summary.orders.forEach(order => {
    const orderTotal = order.items.reduce(
      (sum, item) => sum + item.price * item.quantity, 0
    );
    text += `  [${order.participantName}] ${orderTotal.toLocaleString()}ì›\n`;
    order.items.forEach(item => {
      text += `    - ${item.menuName} x ${item.quantity}\n`;
    });
    if (order.specialRequest) {
      text += `    ë©”ëª¨: ${order.specialRequest}\n`;
    }
  });

  return text;
}
```

#### PNG ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
```typescript
import html2canvas from 'html2canvas';

async function downloadOrderImage(elementId: string, filename: string): Promise<void> {
  const element = document.getElementById(elementId);
  if (!element) return;

  const canvas = await html2canvas(element, {
    backgroundColor: '#ffffff',
    scale: 2, // ê³ í•´ìƒë„
  });

  const link = document.createElement('a');
  link.download = filename;
  link.href = canvas.toDataURL('image/png');
  link.click();
}
```

### 5.5 ì •ì‚°

#### ê°œì¸ë³„ ê¸ˆì•¡ ê³„ì‚°
```typescript
interface ParticipantBill {
  participantName: string;
  items: OrderItem[];
  totalAmount: number;
}

function calculateIndividualBills(sessionId: string): ParticipantBill[] {
  const orders: Order[] = JSON.parse(
    localStorage.getItem(`orders:${sessionId}`) || '[]'
  );

  return orders.map(order => {
    const totalAmount = order.items.reduce(
      (sum, item) => sum + item.price * item.quantity,
      0
    );

    return {
      participantName: order.participantName,
      items: order.items,
      totalAmount,
    };
  });
}
```

#### 1/N ì •ì‚° ê³„ì‚°
```typescript
function calculateEvenSplit(sessionId: string): { perPerson: number; participants: string[] } {
  const summary = generateOrderSummary(sessionId);

  return {
    perPerson: summary.perPersonAmount,
    participants: Array.from(new Set(summary.orders.map(o => o.participantName))),
  };
}
```

## 6. ë°ì´í„° ëª¨ë¸ (TypeScript)

### 6.1 ì™„ì „í•œ íƒ€ì… ì •ì˜
```typescript
// ============================================
// ì„¸ì…˜ ê´€ë ¨
// ============================================
interface OrderSession {
  id: string;
  restaurantName: string;
  mode: 'fixed' | 'free';
  menus: MenuItem[];
  deadline?: Date;
  createdAt: Date;
  hostName: string;
  isActive: boolean;
}

interface MenuItem {
  id: string;
  name: string;
  price: number;
  description?: string;
  category?: string;
  imageUrl?: string;
}

// ============================================
// ì£¼ë¬¸ ê´€ë ¨
// ============================================
interface Order {
  id: string;
  sessionId: string;
  participantName: string;
  items: OrderItem[];
  specialRequest?: string;
  submittedAt: Date;
  updatedAt?: Date;
}

interface OrderItem {
  id: string;
  menuId?: string; // ê³ ì • ë©”ë‰´ ëª¨ë“œì—ì„œë§Œ
  menuName: string;
  price: number;
  quantity: number;
  options?: string[]; // ë§µê¸°, ì‚¬ì´ì¦ˆ ë“±
}

// ============================================
// ì§‘ê³„ ê´€ë ¨
// ============================================
interface OrderSummary {
  restaurantName: string;
  totalAmount: number;
  perPersonAmount: number;
  participantCount: number;
  menuSummary: MenuSummaryItem[];
  orders: Order[];
  generatedAt: Date;
}

interface MenuSummaryItem {
  menuName: string;
  totalQuantity: number;
  unitPrice: number;
  subtotal: number;
  orderedBy: string[]; // ëˆ„ê°€ ì£¼ë¬¸í–ˆëŠ”ì§€
}

interface ParticipantBill {
  participantName: string;
  items: OrderItem[];
  totalAmount: number;
  isPaid?: boolean;
}

// ============================================
// BroadcastChannel ë©”ì‹œì§€
// ============================================
type BroadcastMessage =
  | { type: 'NEW_ORDER'; order: Order }
  | { type: 'UPDATE_ORDER'; order: Order }
  | { type: 'DELETE_ORDER'; orderId: string }
  | { type: 'SESSION_CLOSED'; sessionId: string }
  | { type: 'DEADLINE_UPDATED'; deadline: Date };
```

### 6.2 localStorage í‚¤ ê·œì¹™
```typescript
// ì„¸ì…˜ ì •ë³´
const SESSION_KEY = (id: string) => `session:${id}`;

// ì„¸ì…˜ì˜ ëª¨ë“  ì£¼ë¬¸
const ORDERS_KEY = (sessionId: string) => `orders:${sessionId}`;

// ë‚´ ì£¼ë¬¸ ì •ë³´ (ì°¸ê°€ì ì…ì¥)
const MY_ORDER_KEY = (sessionId: string, participantName: string) =>
  `myorder:${sessionId}:${participantName}`;

// ì„¸ì…˜ ë¦¬ìŠ¤íŠ¸ (í˜¸ìŠ¤íŠ¸ê°€ ìƒì„±í•œ ì„¸ì…˜ë“¤)
const SESSION_LIST_KEY = 'session:list';
```

## 7. localStorage ê¸°ë°˜ ì‹¤ì‹œê°„ ë™ê¸°í™”

### 7.1 BroadcastChannel ìœ í‹¸ë¦¬í‹°
```typescript
class OrderBroadcaster {
  private channel: BroadcastChannel | null = null;
  private sessionId: string;
  private listeners: Map<string, Function[]> = new Map();

  constructor(sessionId: string) {
    this.sessionId = sessionId;

    // BroadcastChannel ì§€ì› í™•ì¸
    if (typeof BroadcastChannel !== 'undefined') {
      this.channel = new BroadcastChannel(`session:${sessionId}`);
      this.channel.onmessage = this.handleMessage.bind(this);
    } else {
      // Fallback: localStorage ì´ë²¤íŠ¸ ì‚¬ìš©
      window.addEventListener('storage', this.handleStorageEvent.bind(this));
    }
  }

  private handleMessage(event: MessageEvent<BroadcastMessage>) {
    const { type } = event.data;
    const callbacks = this.listeners.get(type) || [];
    callbacks.forEach(cb => cb(event.data));
  }

  private handleStorageEvent(event: StorageEvent) {
    if (event.key?.startsWith(`orders:${this.sessionId}`)) {
      // localStorageê°€ ë³€ê²½ë˜ë©´ ì „ì²´ ì£¼ë¬¸ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
      const callbacks = this.listeners.get('STORAGE_CHANGED') || [];
      callbacks.forEach(cb => cb({ type: 'STORAGE_CHANGED', key: event.key }));
    }
  }

  on(type: string, callback: Function) {
    if (!this.listeners.has(type)) {
      this.listeners.set(type, []);
    }
    this.listeners.get(type)!.push(callback);
  }

  off(type: string, callback: Function) {
    const callbacks = this.listeners.get(type) || [];
    const index = callbacks.indexOf(callback);
    if (index > -1) {
      callbacks.splice(index, 1);
    }
  }

  broadcast(message: BroadcastMessage) {
    if (this.channel) {
      this.channel.postMessage(message);
    } else {
      // Fallback: localStorage ì§ì ‘ ì—…ë°ì´íŠ¸
      // ë‹¤ë¥¸ íƒ­ì˜ storage ì´ë²¤íŠ¸ê°€ íŠ¸ë¦¬ê±°ë¨
      const key = `broadcast:${this.sessionId}:${Date.now()}`;
      localStorage.setItem(key, JSON.stringify(message));
      // ì„ì‹œ í‚¤ëŠ” ì¦‰ì‹œ ì‚­ì œ
      setTimeout(() => localStorage.removeItem(key), 100);
    }
  }

  close() {
    if (this.channel) {
      this.channel.close();
    }
    window.removeEventListener('storage', this.handleStorageEvent.bind(this));
    this.listeners.clear();
  }
}
```

### 7.2 React Hookìœ¼ë¡œ í†µí•©
```typescript
function useOrderSync(sessionId: string) {
  const [orders, setOrders] = useState<Order[]>([]);
  const broadcasterRef = useRef<OrderBroadcaster | null>(null);

  useEffect(() => {
    // ì´ˆê¸° ë¡œë“œ
    const ordersKey = `orders:${sessionId}`;
    const initialOrders = JSON.parse(localStorage.getItem(ordersKey) || '[]');
    setOrders(initialOrders);

    // Broadcaster ì´ˆê¸°í™”
    const broadcaster = new OrderBroadcaster(sessionId);
    broadcasterRef.current = broadcaster;

    // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ
    broadcaster.on('NEW_ORDER', (data: { order: Order }) => {
      setOrders(prev => [...prev, data.order]);
    });

    broadcaster.on('UPDATE_ORDER', (data: { order: Order }) => {
      setOrders(prev => prev.map(o => o.id === data.order.id ? data.order : o));
    });

    broadcaster.on('DELETE_ORDER', (data: { orderId: string }) => {
      setOrders(prev => prev.filter(o => o.id !== data.orderId));
    });

    broadcaster.on('STORAGE_CHANGED', () => {
      // Fallback: ì „ì²´ ë‹¤ì‹œ ë¡œë“œ
      const updatedOrders = JSON.parse(localStorage.getItem(ordersKey) || '[]');
      setOrders(updatedOrders);
    });

    return () => {
      broadcaster.close();
    };
  }, [sessionId]);

  const addOrder = useCallback((order: Omit<Order, 'id' | 'submittedAt'>) => {
    const newOrder: Order = {
      ...order,
      id: nanoid(10),
      submittedAt: new Date(),
    };

    // localStorageì— ì €ì¥
    const ordersKey = `orders:${sessionId}`;
    const existingOrders = JSON.parse(localStorage.getItem(ordersKey) || '[]');
    existingOrders.push(newOrder);
    localStorage.setItem(ordersKey, JSON.stringify(existingOrders));

    // BroadcastChannelë¡œ ì•Œë¦¼
    broadcasterRef.current?.broadcast({ type: 'NEW_ORDER', order: newOrder });

    // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
    setOrders(prev => [...prev, newOrder]);
  }, [sessionId]);

  const updateOrder = useCallback((orderId: string, updates: Partial<Order>) => {
    const ordersKey = `orders:${sessionId}`;
    const existingOrders: Order[] = JSON.parse(localStorage.getItem(ordersKey) || '[]');
    const updatedOrders = existingOrders.map(o =>
      o.id === orderId ? { ...o, ...updates, updatedAt: new Date() } : o
    );
    localStorage.setItem(ordersKey, JSON.stringify(updatedOrders));

    const updatedOrder = updatedOrders.find(o => o.id === orderId)!;
    broadcasterRef.current?.broadcast({ type: 'UPDATE_ORDER', order: updatedOrder });

    setOrders(updatedOrders);
  }, [sessionId]);

  const deleteOrder = useCallback((orderId: string) => {
    const ordersKey = `orders:${sessionId}`;
    const existingOrders: Order[] = JSON.parse(localStorage.getItem(ordersKey) || '[]');
    const filteredOrders = existingOrders.filter(o => o.id !== orderId);
    localStorage.setItem(ordersKey, JSON.stringify(filteredOrders));

    broadcasterRef.current?.broadcast({ type: 'DELETE_ORDER', orderId });

    setOrders(filteredOrders);
  }, [sessionId]);

  return { orders, addOrder, updateOrder, deleteOrder };
}
```

## 8. ì£¼ë¬¸ ì§‘ê³„ ì•Œê³ ë¦¬ì¦˜

### 8.1 ë©”ë‰´ë³„ ì§‘ê³„ (Map ê¸°ë°˜)
```typescript
function aggregateByMenu(orders: Order[]): MenuSummaryItem[] {
  const menuMap = new Map<string, {
    quantity: number;
    subtotal: number;
    unitPrice: number;
    orderedBy: Set<string>;
  }>();

  orders.forEach(order => {
    order.items.forEach(item => {
      const key = item.menuName;

      if (menuMap.has(key)) {
        const existing = menuMap.get(key)!;
        existing.quantity += item.quantity;
        existing.subtotal += item.price * item.quantity;
        existing.orderedBy.add(order.participantName);
      } else {
        menuMap.set(key, {
          quantity: item.quantity,
          subtotal: item.price * item.quantity,
          unitPrice: item.price,
          orderedBy: new Set([order.participantName]),
        });
      }
    });
  });

  return Array.from(menuMap.entries()).map(([menuName, data]) => ({
    menuName,
    totalQuantity: data.quantity,
    unitPrice: data.unitPrice,
    subtotal: data.subtotal,
    orderedBy: Array.from(data.orderedBy),
  }));
}
```

### 8.2 ì°¸ê°€ìë³„ ì§‘ê³„
```typescript
function aggregateByParticipant(orders: Order[]): ParticipantBill[] {
  return orders.map(order => {
    const totalAmount = order.items.reduce(
      (sum, item) => sum + item.price * item.quantity,
      0
    );

    return {
      participantName: order.participantName,
      items: order.items,
      totalAmount,
    };
  }).sort((a, b) => b.totalAmount - a.totalAmount); // ê¸ˆì•¡ ë‚´ë¦¼ì°¨ìˆœ
}
```

### 8.3 í†µê³„ ê³„ì‚°
```typescript
interface OrderStats {
  totalAmount: number;
  averageAmount: number;
  maxAmount: number;
  minAmount: number;
  participantCount: number;
  totalItems: number;
  mostPopularMenu: string;
}

function calculateStats(orders: Order[]): OrderStats {
  const participantBills = aggregateByParticipant(orders);
  const menuSummary = aggregateByMenu(orders);

  const amounts = participantBills.map(p => p.totalAmount);
  const totalAmount = amounts.reduce((sum, amt) => sum + amt, 0);

  const mostPopular = menuSummary.reduce((max, item) =>
    item.totalQuantity > max.totalQuantity ? item : max
  , menuSummary[0] || { menuName: 'N/A', totalQuantity: 0 });

  return {
    totalAmount,
    averageAmount: Math.round(totalAmount / participantBills.length),
    maxAmount: Math.max(...amounts),
    minAmount: Math.min(...amounts),
    participantCount: participantBills.length,
    totalItems: orders.reduce((sum, o) => sum + o.items.length, 0),
    mostPopularMenu: mostPopular.menuName,
  };
}
```

## 9. ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

### 9.1 ì „ì²´ êµ¬ì¡°
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ host/
â”‚   â”‚   â”œâ”€â”€ CreateSessionForm.tsx      # ì„¸ì…˜ ìƒì„± í¼
â”‚   â”‚   â”œâ”€â”€ SessionQRCode.tsx          # QR ì½”ë“œ ìƒì„± & ë§í¬ ê³µìœ 
â”‚   â”‚   â”œâ”€â”€ LiveDashboard.tsx          # ì‹¤ì‹œê°„ ì£¼ë¬¸ í˜„í™©
â”‚   â”‚   â”œâ”€â”€ MenuSummaryTable.tsx       # ë©”ë‰´ë³„ ì§‘ê³„ í…Œì´ë¸”
â”‚   â”‚   â”œâ”€â”€ ParticipantList.tsx        # ì°¸ì—¬ì ëª©ë¡
â”‚   â”‚   â””â”€â”€ OrderSummaryExport.tsx     # ì£¼ë¬¸ì„œ ì¶œë ¥/ê³µìœ 
â”‚   â”‚
â”‚   â”œâ”€â”€ participant/
â”‚   â”‚   â”œâ”€â”€ JoinSession.tsx            # ì„¸ì…˜ ì°¸ì—¬ (ë‹‰ë„¤ì„ ì…ë ¥)
â”‚   â”‚   â”œâ”€â”€ MenuSelector.tsx           # ë©”ë‰´ ì„ íƒ (ê³ ì • ëª¨ë“œ)
â”‚   â”‚   â”œâ”€â”€ FreeInputForm.tsx          # ììœ  ì…ë ¥ (ììœ  ëª¨ë“œ)
â”‚   â”‚   â”œâ”€â”€ OrderCart.tsx              # ì¥ë°”êµ¬ë‹ˆ (ìˆ˜ëŸ‰ ì¡°ì ˆ)
â”‚   â”‚   â””â”€â”€ OrderConfirmation.tsx      # ì£¼ë¬¸ í™•ì¸/ì œì¶œ
â”‚   â”‚
â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â”œâ”€â”€ MenuItem.tsx               # ë©”ë‰´ ì•„ì´í…œ ì¹´ë“œ
â”‚   â”‚   â”œâ”€â”€ PriceDisplay.tsx           # ê°€ê²© í‘œì‹œ (ì²œ ë‹¨ìœ„ ì½¤ë§ˆ)
â”‚   â”‚   â”œâ”€â”€ Timer.tsx                  # ë§ˆê° íƒ€ì´ë¨¸
â”‚   â”‚   â””â”€â”€ CopyButton.tsx             # ë§í¬ ë³µì‚¬ ë²„íŠ¼
â”‚   â”‚
â”‚   â””â”€â”€ layout/
â”‚       â”œâ”€â”€ Header.tsx
â”‚       â”œâ”€â”€ Footer.tsx
â”‚       â””â”€â”€ Container.tsx
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useOrderSync.ts                # ì‹¤ì‹œê°„ ì£¼ë¬¸ ë™ê¸°í™”
â”‚   â”œâ”€â”€ useSession.ts                  # ì„¸ì…˜ ê´€ë¦¬
â”‚   â”œâ”€â”€ useQRCode.ts                   # QR ì½”ë“œ ìƒì„±
â”‚   â””â”€â”€ useOrderSummary.ts             # ì£¼ë¬¸ ì§‘ê³„
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ OrderBroadcaster.ts            # BroadcastChannel ë˜í¼
â”‚   â”œâ”€â”€ storage.ts                     # localStorage ìœ í‹¸
â”‚   â”œâ”€â”€ orderService.ts                # ì£¼ë¬¸ CRUD
â”‚   â””â”€â”€ exportService.ts               # ì£¼ë¬¸ì„œ ë‚´ë³´ë‚´ê¸°
â”‚
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                       # ëª¨ë“  íƒ€ì… ì •ì˜
â”‚
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ HomePage.tsx                   # ëœë”© í˜ì´ì§€
â”‚   â”œâ”€â”€ CreateSessionPage.tsx          # ì„¸ì…˜ ìƒì„± í˜ì´ì§€
â”‚   â”œâ”€â”€ HostDashboardPage.tsx          # í˜¸ìŠ¤íŠ¸ ëŒ€ì‹œë³´ë“œ
â”‚   â”œâ”€â”€ JoinSessionPage.tsx            # ì°¸ì—¬ì ì£¼ë¬¸ í˜ì´ì§€
â”‚   â””â”€â”€ SummaryPage.tsx                # ì£¼ë¬¸ì„œ í˜ì´ì§€
â”‚
â””â”€â”€ App.tsx
```

### 9.2 ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ì˜ˆì‹œ

#### CreateSessionForm.tsx
```typescript
export function CreateSessionForm() {
  const [restaurantName, setRestaurantName] = useState('');
  const [mode, setMode] = useState<'fixed' | 'free'>('fixed');
  const [menus, setMenus] = useState<MenuItem[]>([]);
  const navigate = useNavigate();

  const handleSubmit = () => {
    const session = createSession({
      restaurantName,
      mode,
      menus,
      hostName: 'ì£¼ìµœì', // ë‚˜ì¤‘ì— ì‚¬ìš©ì ì…ë ¥ë°›ê¸°
    });

    navigate(`/host/${session.id}`);
  };

  return (
    <form onSubmit={handleSubmit}>
      {/* ê°€ê²Œ ì´ë¦„ ì…ë ¥ */}
      <input
        type="text"
        value={restaurantName}
        onChange={e => setRestaurantName(e.target.value)}
        placeholder="ê°€ê²Œ/ì‹ë‹¹ ì´ë¦„"
        required
      />

      {/* ëª¨ë“œ ì„ íƒ */}
      <div>
        <label>
          <input
            type="radio"
            value="fixed"
            checked={mode === 'fixed'}
            onChange={() => setMode('fixed')}
          />
          ê³ ì • ë©”ë‰´ (ë¯¸ë¦¬ ë©”ë‰´ ì…ë ¥)
        </label>
        <label>
          <input
            type="radio"
            value="free"
            checked={mode === 'free'}
            onChange={() => setMode('free')}
          />
          ììœ  ì…ë ¥ (ì°¸ê°€ìê°€ ì§ì ‘ ì…ë ¥)
        </label>
      </div>

      {/* ê³ ì • ë©”ë‰´ ëª¨ë“œì¼ ë•Œë§Œ ë©”ë‰´ ì…ë ¥ */}
      {mode === 'fixed' && (
        <MenuInputList menus={menus} setMenus={setMenus} />
      )}

      <button type="submit">ì„¸ì…˜ ìƒì„±</button>
    </form>
  );
}
```

#### LiveDashboard.tsx
```typescript
export function LiveDashboard({ sessionId }: { sessionId: string }) {
  const { orders } = useOrderSync(sessionId);
  const summary = useOrderSummary(sessionId);

  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      {/* ì™¼ìª½: ì°¸ì—¬ì ëª©ë¡ */}
      <ParticipantList orders={orders} />

      {/* ì˜¤ë¥¸ìª½: ë©”ë‰´ë³„ ì§‘ê³„ */}
      <MenuSummaryTable summary={summary.menuSummary} />

      {/* í•˜ë‹¨: í†µê³„ */}
      <div className="lg:col-span-2">
        <div className="grid grid-cols-3 gap-4">
          <StatCard label="ì´ ê¸ˆì•¡" value={`${summary.totalAmount.toLocaleString()}ì›`} />
          <StatCard label="ì°¸ì—¬ ì¸ì›" value={`${summary.participantCount}ëª…`} />
          <StatCard label="1ì¸ë‹¹" value={`${summary.perPersonAmount.toLocaleString()}ì›`} />
        </div>
      </div>
    </div>
  );
}
```

#### MenuSelector.tsx (ì°¸ê°€ììš©)
```typescript
export function MenuSelector({
  sessionId,
  onSubmit
}: {
  sessionId: string;
  onSubmit: (order: Omit<Order, 'id' | 'submittedAt'>) => void;
}) {
  const [session] = useState<OrderSession>(() =>
    JSON.parse(localStorage.getItem(`session:${sessionId}`) || '{}')
  );
  const [selectedItems, setSelectedItems] = useState<OrderItem[]>([]);
  const [participantName, setParticipantName] = useState('');
  const [specialRequest, setSpecialRequest] = useState('');

  const handleAddItem = (menu: MenuItem, quantity: number) => {
    setSelectedItems(prev => {
      const existing = prev.find(item => item.menuId === menu.id);
      if (existing) {
        return prev.map(item =>
          item.menuId === menu.id
            ? { ...item, quantity: item.quantity + quantity }
            : item
        );
      }
      return [...prev, {
        id: nanoid(10),
        menuId: menu.id,
        menuName: menu.name,
        price: menu.price,
        quantity,
      }];
    });
  };

  const handleSubmit = () => {
    onSubmit({
      sessionId,
      participantName,
      items: selectedItems,
      specialRequest: specialRequest || undefined,
    });
  };

  return (
    <div>
      {/* ë‹‰ë„¤ì„ ì…ë ¥ */}
      <input
        type="text"
        value={participantName}
        onChange={e => setParticipantName(e.target.value)}
        placeholder="ë‹‰ë„¤ì„ ì…ë ¥"
        required
      />

      {/* ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {session.menus.map(menu => (
          <MenuItem
            key={menu.id}
            menu={menu}
            onAdd={quantity => handleAddItem(menu, quantity)}
          />
        ))}
      </div>

      {/* ì¥ë°”êµ¬ë‹ˆ */}
      <OrderCart items={selectedItems} setItems={setSelectedItems} />

      {/* íŠ¹ì´ì‚¬í•­ */}
      <textarea
        value={specialRequest}
        onChange={e => setSpecialRequest(e.target.value)}
        placeholder="íŠ¹ì´ì‚¬í•­ (ì„ íƒ)"
      />

      <button onClick={handleSubmit}>ì£¼ë¬¸í•˜ê¸°</button>
    </div>
  );
}
```

## 10. ë¼ìš°íŒ… êµ¬ì¡°

```typescript
// App.tsx
import { BrowserRouter, Routes, Route } from 'react-router-dom';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<HomePage />} />
        <Route path="/create" element={<CreateSessionPage />} />
        <Route path="/host/:sessionId" element={<HostDashboardPage />} />
        <Route path="/join/:sessionId" element={<JoinSessionPage />} />
        <Route path="/summary/:sessionId" element={<SummaryPage />} />
      </Routes>
    </BrowserRouter>
  );
}
```

## 11. ì¶”ê°€ ê¸°ëŠ¥ ì•„ì´ë””ì–´

### 11.1 MVP ì´í›„ í™•ì¥ ê°€ëŠ¥ì„±
- ì£¼ë¬¸ ìˆ˜ì • ê¸°ëŠ¥ (ë§ˆê° ì „ê¹Œì§€)
- ì°¸ê°€ì ê°•í‡´ (í˜¸ìŠ¤íŠ¸ ê¶Œí•œ)
- ë©”ë‰´ ì¶”ì²œ (ì¸ê¸° ë©”ë‰´ í‘œì‹œ)
- ê³¼ê±° ì£¼ë¬¸ ì´ë ¥ ì €ì¥
- ì •ì‚° ì™„ë£Œ ì²´í¬
- ì¹´ì¹´ì˜¤í˜ì´ ì†¡ê¸ˆ ë§í¬ ìƒì„±
- PWA ì„¤ì¹˜ ì§€ì›
- ì•Œë¦¼ ê¸°ëŠ¥ (ìƒˆ ì£¼ë¬¸ ì•Œë¦¼)

### 11.2 ê¸°ìˆ  ê°œì„ 
- IndexedDBë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ (ë” í° ì €ì¥ ê³µê°„)
- WebRTCë¥¼ í†µí•œ P2P ë™ê¸°í™”
- Service Workerë¡œ ì˜¤í”„ë¼ì¸ ì§€ì›

## 12. ì°¸ê³  ìë£Œ

### ë°°ë‹¬ì˜ë¯¼ì¡± í•¨ê»˜ì£¼ë¬¸ ë¶„ì„
- [ìš°ì•„í•œí˜•ì œë“¤ ê¸°ìˆ ë¸”ë¡œê·¸ - í•¨ê»˜ì£¼ë¬¸ ì˜¤í”ˆ ì´ì•¼ê¸°](https://techblog.woowahan.com/10232/)

### BroadcastChannel API
- [DigitalOcean - How to use the BroadcastChannel API](https://www.digitalocean.com/community/tutorials/js-broadcastchannel-api)
- [Telerik - Ultimate Guide to Broadcast Channel API](https://www.telerik.com/blogs/ultimate-guide-broadcast-channel-api)
- [TabStateSync Library (TypeScript)](https://github.com/robertluiz/TabStateSync)

### ë¼ì´ë¸ŒëŸ¬ë¦¬
- [node-qrcode](https://github.com/soldair/node-qrcode)
- [html2canvas](https://html2canvas.hertzen.com/)
- [nanoid](https://github.com/ai/nanoid)

## 15. MCP ê°œë°œ ë„êµ¬

### 15.1 UI ì»´í¬ë„ŒíŠ¸ ê°œë°œ
- **Shadcn UI**: ê²€ì¦ëœ ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
- `pnpm dlx shadcn@latest add [component]`ë¡œ ì¶”ê°€
- `@mini-apps/ui` íŒ¨í‚¤ì§€ì—ì„œ ê³µìœ 

### 15.2 ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸
- **Chrome DevTools MCP**: ì‹¤ì‹œê°„ UI í™•ì¸ ë° ë””ë²„ê¹…
- ìŠ¤ëƒ…ìƒ·/ìŠ¤í¬ë¦°ìƒ·ìœ¼ë¡œ ë Œë”ë§ í™•ì¸
- ì½˜ì†”/ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ë¶„ì„
- ë°˜ì‘í˜• í…ŒìŠ¤íŠ¸ (ëª¨ë°”ì¼ ë·°í¬íŠ¸)

> ìì„¸í•œ ì‚¬ìš©ë²•ì€ `agents/mini-apps/CLAUDE.md` ì°¸ì¡°

---

**PRD ì‘ì„±ì¼**: 2025-12-20
**ë²„ì „**: 1.0
**ë‹´ë‹¹ì**: SeolCoding
